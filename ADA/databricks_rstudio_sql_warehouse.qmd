---
  title: "Connecting to Databricks from RStudio"
---

The following instructions will help you to set up a connection between your laptop and your Databricks SQL warehouse, which can then be used in RStudio to query data.

You can use data from the SQL warehouse in two different ways:

-   In the SQL editor or in notebooks via the Databricks environment
-   In RStudio, similarly to the way that you might currently use SQL Server

---

## Pre-requisites

Before you start, you must have:

-   Access to the Databricks platform

-   Access to data in a SQL Warehouse on Databricks

-   R and RStudio downloaded and installed

-   The `ODBC` package installed in RStudio

If you do not have access to Databricks or a SQL Warehouse within Databricks, you can request this using [a service request form](https://dfe.service-now.com/serviceportal?id=sc_cat_item&sys_id=74bc3be81b212d504f999978b04bcb0b).

If you do not have R or RStudio, you can find them both in the Software Centre. Note that you need both R **and** RStudio installed.

---

## Process

There are three steps to complete before your connection can be established. These are:

-   Installing an ODBC driver on your laptop to enable a connection between your laptop and Databricks
-   Modifying your .Renviron file to establish a connection between RStudio and Databricks
-   Adding connection code to your existing scripts in RStudio

Each of these steps is described in more detail in the sections below. 

---

### Setting up the ODBC driver

An ODBC driver is required for the `ODBC` package in R to work - you must install it before attempting to use the package to connect to your data. 

---

#### Install the Simba Spark ODBC driver from the Software Centre

---

-   Open the Software Centre via the start menu

-   In the 'Applications' tab, click `Simba Spark ODBC Driver 64-bit`

::: {align="center"}
![](../images/databricks-software-centre.png)
:::

-   Click install

------------------------------------------------------------------------

### Establishing an RStudio connection using environment variables

------------------------------------------------------------------------

The `ODBC` package in RStudio allows you to connect to Databricks by creating and modifying four environment variables in your .Renviron file.

To set the environment variables, call `usethis::edit_r_environ()`. You will then need to enter the following information:

```         
DATABRICKS_HOST=<databricks-host>
DATABRICKS_SQL_WAREHOUSE_ID=<sql-warehouse-id>
DATABRICKS_TOKEN=<personal-access-token> 
DATABRICKS_CLUSTER_ID=<personal-cluster-id>
```

::: callout-important
Each value should be entered inside quotation marks, like this:
DATABRICKS_SQL_WAREHOUSE_ID="/sql/1.0/warehouses/abcdefgh123"
:::

Once you have entered the details, save and close your .Renviron file.

::: callout-note
Everyone in your team that wishes to connect to the SQL Warehouse in Databricks and run your code must set up their .Renviron file individually, otherwise their connection will fail.
:::

The sections below describe where to find the information needed for each of the four environment variables.

------------------------------------------------------------------------

#### Databricks host

------------------------------------------------------------------------

The Databricks host is the instance of Databricks that you want to connect to. It's the URL that you see in your browser bar when you're on the Databricks site and should end in "azuredatabricks.net" (ignore anything after this section of the URL).

------------------------------------------------------------------------

#### Databricks SQL Warehouse ID

------------------------------------------------------------------------

The Databricks SQL warehouse ID is the warehouse containing data that you would like to use. To get the warehouse ID, follow these steps:

-   click 'SQL Warehouses' under the 'SQL' section of the left hand menu on Databricks
-   click on the warehouse name that you'd like to get the ID for
-   the warehouse id is the 'HTTP Path' in the 'Connection details' tab
-   the ID should start with something similar to "/sql/1.0/warehouses/"


------------------------------------------------------------------------

#### Databricks token

------------------------------------------------------------------------

The Databricks token is a personal access token. 

A personal access token is is a security measure that acts as an identifier to let Databricks know who is accessing information from the SQL warehouse. Access tokens are usually set for a limited amount of time, so they will need renewing periodically.

-   In Databricks, click on your email address in the top right corner, then click 'User settings'

-   Go to the 'Developer' tab in the side bar. Next to 'Access tokens', click the 'Manage' button

::: {align="center"}
![](../images/databricks-access-tokens.png)
:::

-   Click the 'Generate new token' button

-   Name the token, then click 'Generate'

::: callout-note
Note that access tokens will only last as long as the value for the 'Lifetime (days)' field. After this period the token will expire, and you will need to create a new one to re-authenticate.
:::

-   Make a note of the 'Databricks access token' it has given you

::: callout-warning
It is very important that you immediately copy the access token that you are given, as you will not be able to see it through Databricks again. If you lose this access token before pasting it into RStudio then you must generate a new access token to replace it.
:::

------------------------------------------------------------------------

#### Cluster ID

------------------------------------------------------------------------

The Cluster ID is the cluster that you'll be using to run your code.

To obtain this, follow these steps:

-   click Compute in the left and menu, and click on the name of your cluster
-   under the configuration tab, click on "Advanced options" at the bottom of the page
-   click on the JDBC/ODBC tab
-   in HTTP path, copy everything after the last /. This is your Cluster ID 

------------------------------------------------------------------------

### Pulling data into RStudio from Databricks

------------------------------------------------------------------------

Now that you have established a connection between Databricks and your laptop, and between Databricks and RStudio, you can add code to your existing scripts to pull data into RStudio for analysis. If you have connected to other SQL databases before, this code will look quite familiar to you. 

To access the data, we will make use of the `ODBC` package. You can find documentation about this package [on the Posit website](https://solutions.posit.co/connections/db/r-packages/odbc/).

Include the following code in your R Script:


``` {r databricks_connect_sql, eval=FALSE}
library(odbc)

con <- DBI::dbConnect(
  odbc::databricks(),
  httpPath = Sys.getenv("DATABRICKS_SQL_WAREHOUSE_ID"),
  workspace = Sys.getenv("DATABRICKS_HOST")
)

odbcListObjects(con)
```

---